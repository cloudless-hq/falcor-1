{"version":3,"sources":["../../src/components/connect.js"],"names":["prototype","changes","_root","onChangesCompleted","call","next","contextTypes","falcor","object","version","number","dispatch","func","connect","BaseComponent","data","props","switchMap","getVersion","distinctUntilKeyChanged","auditTime","asap","componentDidUpdate","type"],"mappings":";;;;;;;;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AAEA;;AACA;;;;AACA;;AAEA;;;;;;AACA,cAAMA,SAAN,CAAgBC,OAAhB,GAA0B,YAAW;AAAA;;AAAA,QACzBC,KADyB,GACf,IADe,CACzBA,KADyB;AAAA,QAE3BD,OAF2B,GAEfC,KAFe,CAE3BD,OAF2B;;AAGjC,QAAI,CAACA,OAAL,EAAc;AAAA;AACVA,sBAAUC,MAAMD,OAAN,GAAgB,gCAA1B;AADU,gBAEFE,kBAFE,GAEqBD,KAFrB,CAEFC,kBAFE;;AAGVD,kBAAMC,kBAAN,GAA2B,YAAW;AAClC,oBAAIA,kBAAJ,EAAwB;AACpBA,uCAAmBC,IAAnB,CAAwB,IAAxB;AACH;AACDH,wBAAQI,IAAR,CAAa,IAAb;AACH,aALD;AAHU;AASb;AACD,WAAOJ,OAAP;AACH,CAdD;;AAgBA;;AAEA,IAAMK,eAAe;AACjBC,YAAQ,iBAAUC,MADD;AAEjBC,aAAS,iBAAUC,MAFF;AAGjBC,cAAU,iBAAUC;AAHH,CAArB;;AAMA,IAAMC,UAAU,SAAVA,OAAU,CAACC,aAAD;AAAA,WAAmB,uBAC/B,yBAAa,UAACC,IAAD;AAAA,YAASR,MAAT,QAASA,MAAT;AAAA,eAAuB;AAChCQ,kBAAM,+BAAgBA,IAAhB,EAAsBR,MAAtB;AAD0B,SAAvB;AAAA,KAAb,CAD+B,EAI/B,8BAAe,+BACXO,aADW,EACI,QADJ,CAAf,CAJ+B,EAO/B,8BAAe,UAACE,KAAD;AAAA,eAAWA,MACrBC,SADqB,CAElB;AAAA,gBAAGV,MAAH,SAAGA,MAAH;AAAA,mBAAgBA,OAAON,OAAP,EAAhB;AAAA,SAFkB,EAGlB,iBAAeM,MAAf;AAAA,gBAAMS,KAAN;;AAAA,gCACOA,KADP,IACcT,cADd,EACsBE,SAASF,OAAOW,UAAP;AAD/B;AAAA,SAHkB,EAOrBC,uBAPqB,CAOG,SAPH,EAQrBC,SARqB,CAQX,CARW,EAQR,gBAAUC,IARF,CAAX;AAAA,KAAf,CAP+B,EAiB/B,2BAAYf,YAAZ,EAA0B;AAAA,YAAGC,MAAH,SAAGA,MAAH;AAAA,YAAWE,OAAX,SAAWA,OAAX;AAAA,YAAoBE,QAApB,SAAoBA,QAApB;AAAA,eAAoC;AAC1DJ,0BAD0D,EAClDI,kBADkD,EACxCF;AADwC,SAApC;AAAA,KAA1B,CAjB+B,EAoB/B,yBAAU;AACNa,0BADM,gCACe;AACjB,iBAAKN,KAAL,CAAWL,QAAX,CAAoB;AAChBI,sBAAM,KAAKC,KAAL,CAAWD,IADD;AAEhBQ,sBAAM;AAFU,aAApB;AAIH;AANK,KAAV,CApB+B,EA4BjCT,aA5BiC,CAAnB;AAAA,CAAhB;;kBA8BeD,O","file":"connect.js","sourcesContent":["import compose from 'recompose/compose';\nimport toClass from 'recompose/toClass';\nimport mapProps from 'recompose/mapProps';\nimport lifecycle from 'recompose/lifecycle';\nimport setStatic from 'recompose/setStatic';\nimport withProps from 'recompose/withProps';\nimport getContext from 'recompose/getContext';\nimport withContext from 'recompose/withContext';\nimport shouldUpdate from 'recompose/shouldUpdate';\nimport mapPropsStream from 'recompose/mapPropsStream';\nimport setDisplayName from 'recompose/setDisplayName';\nimport wrapDisplayName from 'recompose/wrapDisplayName';\nimport mapToFalcorJSON from '../utils/mapToFalcorJSON';\nimport bindActionCreators from '../utils/bindActionCreators';\nimport setObservableConfig from 'recompose/setObservableConfig';\nimport rxjsObservableConfig from 'recompose/rxjsObservableConfig';\n\nimport { Observable, BehaviorSubject, Scheduler } from 'rxjs';\nimport React, { PropTypes, Children } from 'react';\nimport { connect as connectRedux } from 'react-redux';\n\nimport { Model } from '@graphistry/falcor';\nModel.prototype.changes = function() {\n    const { _root } = this;\n    let { changes } = _root;\n    if (!changes) {\n        changes = _root.changes = new BehaviorSubject(this);\n        const { onChangesCompleted } = _root;\n        _root.onChangesCompleted = function() {\n            if (onChangesCompleted) {\n                onChangesCompleted.call(this);\n            }\n            changes.next(this);\n        }\n    }\n    return changes;\n}\n\nsetObservableConfig(rxjsObservableConfig);\n\nconst contextTypes = {\n    falcor: PropTypes.object,\n    version: PropTypes.number,\n    dispatch: PropTypes.func\n};\n\nconst connect = (BaseComponent) => compose(\n    connectRedux((data, { falcor }) => ({\n        data: mapToFalcorJSON(data, falcor)\n    })),\n    setDisplayName(wrapDisplayName(\n        BaseComponent, 'Falcor'\n    )),\n    mapPropsStream((props) => props\n        .switchMap(\n            ({ falcor }) => falcor.changes(),\n            ({ ...props }, falcor) => ({\n                ...props, falcor, version: falcor.getVersion()\n            })\n        )\n        .distinctUntilKeyChanged('version')\n        .auditTime(0, Scheduler.asap)\n    ),\n    withContext(contextTypes, ({ falcor, version, dispatch }) => ({\n        falcor, dispatch, version\n    })),\n    lifecycle({\n        componentDidUpdate() {\n            this.props.dispatch({\n                data: this.props.data,\n                type: 'falcor-react-redux/update'\n            });\n        }\n    })\n)(BaseComponent);\n\nexport default connect;\n"]}